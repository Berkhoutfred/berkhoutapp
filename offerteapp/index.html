<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berkhout Planning V3.30 (Scope Fix)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAi1U8gP0dlE87sYaUDI2JbKKFxJW_YjlY&libraries=places&callback=initMaps" async defer></script>
    <style>
        :root { --primary: #004a99; --bg: #f3f4f6; --text: #1f2937; --border: #e5e7eb; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 240px; background: var(--primary); color: white; padding: 25px; display: flex; flex-direction: column; z-index: 10; justify-content: space-between; }
        .nav-group { display: flex; flex-direction: column; }
        .brand { font-size: 22px; font-weight: 800; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .nav-item { padding: 14px; cursor: pointer; border-radius: 8px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; transition: 0.2s; font-weight: 500; }
        .nav-item:hover { background: rgba(255,255,255,0.1); }
        .nav-item.active { background: white; color: var(--primary); font-weight: 700; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .main { flex: 1; padding: 30px; overflow-y: auto; position: relative; }
        .page-section { display: none; max-width: 1400px; margin: 0 auto; animation: fadeIn 0.3s ease; }
        .page-section.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { color: var(--primary); border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; margin-bottom: 25px; font-size: 24px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid var(--border); }
        .section-header { font-size: 14px; font-weight: 700; color: #6b7280; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 0.5px; }
        
        label { display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 6px; margin-top: 15px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; box-sizing: border-box; font-family: 'Inter', sans-serif; transition: 0.2s; }
        input:focus, select:focus { border-color: var(--primary); outline: none; ring: 2px solid rgba(0,74,153,0.1); }
        
        /* SEARCH & RESULTS */
        .search-wrapper { position: relative; }
        .search-results { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid var(--primary); border-radius: 6px; max-height: 200px; overflow-y: auto; z-index: 100; display: none; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .search-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; font-size: 13px; }
        .search-item:hover { background: #f0f9ff; color: var(--primary); }

        /* DASHBOARD */
        .filter-bar { background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center; display: flex; align-items: center; justify-content: space-between; }
        .year-selector { display: flex; align-items: center; gap: 20px; font-size: 24px; font-weight: 800; color: var(--primary); }
        .year-btn { background: none; border: none; font-size: 20px; cursor: pointer; color: #9ca3af; transition: 0.2s; }
        .year-btn:hover { color: var(--primary); transform: scale(1.2); }
        .month-grid { display: flex; gap: 5px; flex-wrap: wrap; }
        .month-btn { padding: 6px 12px; border: 1px solid #e5e7eb; background: #fff; border-radius: 20px; cursor: pointer; font-size: 12px; font-weight: 600; color: #6b7280; transition: 0.2s; }
        .month-btn:hover { background: #f3f4f6; }
        .month-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* TABLES */
        .rit-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .rit-table th { text-align: left; padding: 12px; background: #f9fafb; border-bottom: 2px solid #e5e7eb; color: #6b7280; font-weight: 700; text-transform: uppercase; font-size: 11px; }
        .rit-table td { padding: 12px; border-bottom: 1px solid #e5e7eb; vertical-align: middle; }
        .rit-table tr:hover { background: #f0f9ff; }
        .tag { padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; display: inline-block; }
        .tag-blue { background: #dbeafe; color: #1e40af; } 
        .tag-purple { background: #f3e8ff; color: #6b21a8; } 
        .tag-orange { background: #ffedd5; color: #9a3412; }
        
        .status-icon { font-size: 16px; cursor: pointer; color: #e5e7eb; transition: 0.2s; }
        .status-icon:hover { transform: scale(1.2); color: #d1d5db; }
        .status-icon.done { color: var(--success); }
        .status-header { text-align: center !important; width: 40px; font-size: 9px; }
        .status-cell { text-align: center; }
        .action-btn { background: #fff; border: 1px solid #e5e7eb; color: #6b7280; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: 0.2s; }
        .action-btn:hover { border-color: var(--primary); color: var(--primary); background: #f0f9ff; }

        /* CALCULATOR SPECIFIC */
        input[type="date"] { font-family: 'Inter', sans-serif; font-weight: 600; color: var(--primary); }
        .date-text-display { font-size: 12px; color: #6b7280; margin-top: 4px; font-style: italic; min-height: 18px; font-weight: 500; }
        
        .bus-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .bus-option { display: flex; align-items: center; gap: 10px; padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 13px; cursor: pointer; transition: 0.2s; }
        .bus-option:hover { background: #eff6ff; border-color: var(--primary); }
        .bus-option input { width: 18px; height: 18px; margin: 0; flex-shrink: 0; }

        .time-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 10px; background: #fff; border-radius: 6px; margin-bottom: 6px; border: 1px solid #e5e7eb; }
        .select-uur, .select-min { width: 55px; padding: 6px; text-align: center; font-weight: 600; border-radius: 4px; border: 1px solid #d1d5db; cursor: pointer; background: white; }
        .highlight-time { border-left: 3px solid #10b981; background:#f0fdf4; } 
        .rit-divider { background: #eef6ff; color: var(--primary); font-weight: bold; padding: 8px; border-radius: 6px; margin: 15px 0 5px 0; font-size: 12px; text-align: center; border: 1px dashed var(--primary); letter-spacing: 1px; }

        /* FINANCE & STATUS */
        .cost-split { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .correction-box { background: #fdf2f8; border: 1px solid #fbcfe8; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        
        .total-box { background: var(--primary); color: white; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,74,153,0.2); }
        .total-price { font-size: 32px; font-weight: 800; margin: 5px 0; }
        
        .status-table { width: 100%; border-collapse: separate; border-spacing: 0; margin-bottom: 20px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
        .status-table td { padding: 10px; border-bottom: 1px solid #e5e7eb; background: #f9fafb; vertical-align: middle; }
        .status-label { width: 120px; font-size: 12px; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .status-input { background: white !important; }
        .status-input input { border: 1px solid #d1d5db; margin: 0; }

        .profit-footer { background: #ecfdf5; border: 2px solid #10b981; padding: 15px; border-radius: 8px; text-align: center; margin-top: 20px; }
        .profit-title { font-size:11px; font-weight:bold; color:#047857; text-transform:uppercase; letter-spacing: 1px; }
        .profit-amount { font-size:28px; font-weight: 800; color:#047857; margin-top: 5px; }

        /* BUTTONS & CRM */
        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 15px; font-size: 14px; transition: 0.2s; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn:active { transform: scale(0.98); }
        .btn-green { background: #10b981; color: white; box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2); }
        .btn-green:hover { background: #059669; }
        .btn-blue { background: var(--primary); color: white; width: auto; padding: 10px 20px; margin: 0; }
        .btn-grey { background: #9ca3af; color: white; width: auto; padding: 8px 15px; margin: 0; }
        .btn-red { background: #ef4444; color: white; text-align: center; font-size: 12px; padding: 10px; cursor: pointer; border-radius: 6px; margin-top: 10px; }
        
        .contact-row { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 40px; gap: 10px; align-items: center; background: #fafafa; padding: 10px; border: 1px solid #eee; border-radius: 6px; margin-bottom: 8px; }
        .btn-trash { color: var(--danger); border: 1px solid #fee2e2; background: #fff; cursor: pointer; height: 38px; border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .btn-trash:hover { background: #fee2e2; }
        
        .btn-link { background: none; color: var(--primary); width: auto; padding: 0; font-size: 13px; margin-top: 5px; text-decoration: underline; cursor: pointer; border: none; display: inline; }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
        .modal-box { background: white; width: 900px; max-width: 95%; max-height: 90vh; overflow-y: auto; border-radius: 12px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="nav-group">
        <div class="brand"><i class="fa-solid fa-bus"></i> BERKHOUT</div>
        <div class="nav-item active" onclick="nav('dashboard')"><i class="fa-solid fa-calendar-days"></i> Planning</div>
        <div class="nav-item" onclick="nav('calculatie')"><i class="fa-solid fa-calculator"></i> Nieuwe Rit</div>
        <div class="nav-item" onclick="nav('klanten')"><i class="fa-solid fa-users"></i> Klanten</div>
    </div>
    <div class="btn-red" onclick="hardReset()"><i class="fa-solid fa-triangle-exclamation"></i> RESET ALLES</div>
</div>

<div class="main">

    <div id="dashboard" class="page-section active">
        <div class="filter-bar">
            <div class="year-selector">
                <button class="year-btn" onclick="changeYear(-1)"><i class="fa-solid fa-chevron-left"></i></button>
                <span id="display-year">2026</span>
                <button class="year-btn" onclick="changeYear(1)"><i class="fa-solid fa-chevron-right"></i></button>
            </div>
            <div class="month-grid" id="month-buttons"></div>
        </div>
        <div class="card" style="padding:0; overflow:hidden;">
            <table class="rit-table">
                <thead>
                    <tr><th style="width:40px;"></th><th style="width:120px;">Datum</th><th>Type</th><th>Klant</th><th>Bestemming</th><th style="text-align:right;">Prijs</th><th class="status-header">Off</th><th class="status-header">Bev</th><th class="status-header">Opdr</th><th class="status-header">Fact</th><th class="status-header">Bet</th></tr>
                </thead>
                <tbody id="rit-tabel-body"></tbody>
            </table>
            <div id="empty-state" style="padding:40px; text-align:center; color:#999; display:none;">Geen ritten gevonden in deze periode.</div>
        </div>
    </div>

    <div id="calculatie" class="page-section">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="margin:0;">Nieuwe Offerte</h2>
            <button class="btn-grey" onclick="resetForm()"><i class="fa-solid fa-rotate-left"></i> Reset</button>
        </div>
        <div class="grid-2">
            <div>
                <div class="card">
                    <div class="section-header">1. Datum & Klant</div>
                    <div style="display:flex; gap:15px; margin-bottom:15px;">
                        <div style="flex:1;">
                            <label>Startdatum</label><input type="date" id="rit_datum" onchange="syncDates()">
                            <div id="display-start-date" class="date-text-display"></div>
                        </div>
                        <div style="flex:1;">
                            <label>Einddatum</label><input type="date" id="rit_datum_eind" onchange="rekenUren()">
                            <div id="display-end-date" class="date-text-display"></div>
                        </div>
                    </div>
                    
                    <label>Zoek Klant</label>
                    <div class="search-wrapper">
                        <input type="text" id="calc-klant-zoek" placeholder="Typ naam..." oninput="filterCalcClients()">
                        <input type="hidden" id="calc-klant-id">
                        <div class="search-results" id="calc-klant-results"></div>
                    </div>

                    <label>Contactpersoon</label>
                    <select id="calc-contact"><option value="">-- Eerst klant kiezen --</option></select>

                    <label>Aantal Personen</label> 
                    <input type="number" id="calc-pax" placeholder="Bijv. 50">

                    <div id="klant-details" style="display:none; background:#f0f9ff; padding:10px; border-radius:6px; margin-top:10px; font-size:13px; color:#0369a1; border:1px solid #bae6fd;"></div>
                    <label>Kies Voertuig(en)</label><div class="bus-grid" id="bus-container"></div>
                </div>
                <div class="card">
                    <div class="section-header">2. Route</div>
                    <label>Vertrek Garage</label><input type="text" id="route-start" value="Industrieweg 99J, Zutphen">
                    <label>Ophaaladres</label><input type="text" id="route-ophaal" placeholder="Zoek adres..." onchange="berekenRoute()">
                    <button class="btn-link" onclick="toggleVia()">+ Via-locatie</button>
                    <div id="via-container" class="hidden">
                        <label>Via 1</label><input type="text" id="route-via1" onchange="berekenRoute()">
                        <label>Via 2</label><input type="text" id="route-via2" onchange="berekenRoute()">
                    </div>
                    <label>Bestemming</label><input type="text" id="route-eind" placeholder="Zoek bestemming..." onchange="berekenRoute()">
                    <div style="background:#eff6ff; border:1px solid #bfdbfe; padding:15px; border-radius:8px; margin-top:15px;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:14px;"><span>Aanrijtijd:</span><span style="font-weight:bold; color:var(--primary);" id="info-aanrij">-</span></div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:14px;"><span>Rijtijd:</span><span style="font-weight:bold; color:var(--primary);" id="info-rit">-</span></div>
                        <div style="display:flex; justify-content:space-between; font-size:16px; font-weight:bold; border-top:1px dashed #bfdbfe; padding-top:10px; margin-top:5px;"><span>Afstand:</span><span style="color:var(--primary);" id="info-totaal">0 km</span></div>
                    </div>
                </div>
            </div>
            <div>
                <div class="card">
                    <div class="section-header">3. Planning</div>
                    <label style="color:var(--primary);">Type Rit</label>
                    <select id="rit-type" onchange="wisselTijdLijst()" style="font-weight:bold; border:2px solid var(--primary); margin-bottom:15px;">
                        <option value="enkel">Enkele Rit (Brengen)</option>
                        <option value="vv" selected>Dagtocht (Volledig)</option>
                        <option value="brenghaal">Breng & Haal (Gesplitst)</option>
                        <option value="meerdaagse">4. Meerdaagse Rit (CAO)</option>
                    </select>
                    <div id="tijd-standaard"></div>
                    <div id="tijd-brenghaal" class="hidden">
                        <div class="rit-divider">DEEL 1: BRENGEN</div><div id="bh-deel1"></div>
                        <div class="rit-divider">DEEL 2: HALEN</div><div id="bh-deel2"></div>
                    </div>
                    <div id="tijd-meerdaagse" class="hidden">
                        <div class="rit-divider">DAG 1: HEEN</div><div id="md-deel1"></div>
                        <div class="rit-divider">LAATSTE DAG: TERUG</div><div id="md-deel2"></div>
                    </div>
                    <div style="text-align:right; font-weight:bold; margin-top:15px; color:var(--primary); font-size:18px;">Facturabele Uren: <span id="uren-display">0.0</span> uur</div>
                </div>
                <div class="card">
                    <div class="section-header">4. Financiën & Status</div>
                    <label>Variabele Kosten (Excl. BTW)</label>
                    <div class="cost-split">
                        <div><label>Parkeerkosten</label><input type="number" id="cost-parking" value="0" oninput="rekenPrijs()"></div>
                        <div><label>Tolgelden</label><input type="number" id="cost-toll" value="0" oninput="rekenPrijs()"></div>
                        <div><label>Catering/Ov</label><input type="number" id="cost-catering" value="0" oninput="rekenPrijs()"></div>
                    </div>

                    <div class="correction-box">
                        <label style="color:#db2777; font-weight:bold;">Financiële Correctie / Winst (Excl. BTW)</label>
                        <input type="number" id="profit-correction" value="0" placeholder="€ 0.00" oninput="rekenPrijs()" style="font-weight:bold; color:#db2777;">
                    </div>
                    
                    <div class="total-box">
                        <div style="font-size:14px; opacity:0.9;">Totaal incl. 9% BTW</div>
                        <div class="total-price" id="prijs-display">€ 0,00</div>
                        <div style="font-size:13px; opacity:0.9;" id="btw-display">BTW: € 0,00</div>
                    </div>

                    <table class="status-table">
                        <tr>
                            <td class="status-label"><i class="fa-solid fa-paper-plane"></i> Offerte</td>
                            <td class="status-input"><input type="date" id="calc-date-offerte"></td>
                        </tr>
                        <tr>
                            <td class="status-label"><i class="fa-solid fa-thumbs-up"></i> Bevestigd</td>
                            <td class="status-input"><input type="date" id="calc-date-bevestiging"></td>
                        </tr>
                        <tr>
                            <td class="status-label"><i class="fa-solid fa-file-invoice-dollar"></i> Factuur</td>
                            <td class="status-input"><input type="date" id="calc-date-factuur"></td>
                        </tr>
                    </table>

                    <div class="profit-footer">
                        <div class="profit-title">Totale Winst (incl. afronding)</div>
                        <div class="profit-amount" id="live-profit">€ 0</div>
                    </div>

                    <button id="btn-save" class="btn btn-green" onclick="opslaan()"><i class="fa-solid fa-save"></i> RIT OPSLAAN</button>
                </div>
            </div>
        </div>
    </div>

    <div id="klanten" class="page-section">
        <div id="crm-list-view">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="margin:0; border:none;">Klantenbestand</h2>
                <button class="btn-blue" style="width:auto;" onclick="nieuwKlantScherm()">+ Nieuwe Klant</button>
            </div>
            <div class="card">
                <input type="text" id="crm-search" placeholder="Zoek op naam, plaats of email..." onkeyup="renderClientList()" style="margin-bottom:15px;">
                <table class="rit-table">
                    <thead><tr><th>Naam</th><th>Plaats</th><th>Email</th><th>Tel</th><th style="width:80px;">Actie</th></tr></thead>
                    <tbody id="crm-table-body"></tbody>
                </table>
            </div>
        </div>
        <div id="crm-detail-view" class="hidden">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="margin:0; border:none;" id="crm-title">Klant Bewerken</h2>
                <button class="btn-grey" style="width:auto;" onclick="terugNaarLijst()">Terug naar lijst</button>
            </div>
            <div class="card">
                <div class="section-header">Algemene Gegevens</div>
                <div class="grid-2">
                    <div><label>Bedrijfsnaam / Klantnaam</label><input type="text" id="crm-naam"><label>Adres</label><input type="text" id="crm-adres" placeholder="Begin met typen..."></div>
                    <div><label>Plaats</label><input type="text" id="crm-plaats"><div class="grid-2"><div><label>Telefoon Algemeen</label><input type="text" id="crm-tel"></div><div><label>Debiteurnummer</label><input type="text" id="crm-deb"></div></div></div>
                </div>
                <h3>Contactpersonen</h3>
                <div id="crm-contacts-container"></div>
                <button class="btn-link" onclick="addContactRow()">+ Contactpersoon toevoegen</button>
                <div style="border-top:1px solid #eee; margin-top:20px; padding-top:20px;"><button class="btn btn-green" onclick="saveClient()">Klant Opslaan</button></div>
            </div>
        </div>
    </div>
</div>

<div id="offerte-modal" class="hidden modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <span>Offerte Voorbeeld</span>
            <span onclick="closeModal('offerte-modal')" style="cursor:pointer;"><i class="fa-solid fa-times"></i></span>
        </div>
        <div class="modal-body" id="offerte-modal-content"></div>
        <div style="padding:0 20px; text-align:right;">
            <i class="fa-solid fa-pen-to-square" style="cursor:pointer; color:#f59e0b;" onclick="toggleNote()"></i>
            <div id="offerte-note-box" class="note-box">
                <label style="margin-top:0;">Interne Notitie</label>
                <textarea id="offerte-note-text" rows="3"></textarea>
                <button class="btn-blue" style="width:auto; padding:5px 10px; font-size:12px; margin-top:5px;" onclick="saveInternalNote()">Opslaan</button>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-grey" style="width:auto;" onclick="printOfferte()"><i class="fa-solid fa-file-pdf"></i> PDF Maken / Afdrukken</button>
            <button class="btn-green" style="width:auto;" onclick="confirmOfferte()"><i class="fa-solid fa-check"></i> Bevestigen</button>
        </div>
    </div>
</div>

<script>
    // GLOBAL VARS (NO MORE SCOPE ISSUES)
    let db = { klanten: [], ritten: [] };
    let appState = { currentYear: new Date().getFullYear(), currentMonth: new Date().getMonth(), activeClientId: null, activeRitId: null };
    let actieveRitIndex = -1; let enkeleReisKM = 0; let aanrijSec = 0; let ritSec = 0; 
    
    const busOpties = [ {label:'Bus 19',prijs:0.75}, {label:'Bus 23',prijs:0.75}, {label:'Bus 50',prijs:1.00}, {label:'Bus 55',prijs:1.00}, {label:'Bus 60',prijs:1.20}, {label:'Bus 62',prijs:1.20} ];
    const maanden = ['jan','feb','mrt','apr','mei','jun','jul','aug','sep','okt','nov','dec'];
    
    const tijdVeldenStandaard = [ {id:'std_1',label:'1. Vertrek Garage',defH:'08',defM:'00'}, {id:'std_2',label:'2. Voorstaan',defH:'08',defM:'30'}, {id:'std_3',label:'3. Vertrek Klant',defH:'08',defM:'45',trigger:true,style:'highlight-time'}, {id:'std_4',label:'4. Aankomst Loc.',defH:'10',defM:'00'}, {id:'std_5',label:'5. Vertrek Loc.',defH:'16',defM:'00'}, {id:'std_6',label:'6. Retour Klant',defH:'17',defM:'15',trigger:true,style:'highlight-time'}, {id:'std_7',label:'7. Aankomst Garage',defH:'18',defM:'00'} ];
    const tijdVeldenBrengen = [ {id:'br_1',label:'1. Vertrek Garage',defH:'12',defM:'15'}, {id:'br_2',label:'2. Voorstaan',defH:'12',defM:'45'}, {id:'br_3',label:'3. Vertrek Klant',defH:'13',defM:'00'}, {id:'br_4',label:'4. Aankomst Best.',defH:'13',defM:'45'}, {id:'br_5',label:'5. Retour Garage',defH:'14',defM:'30'} ];
    const tijdVeldenHalen = [ {id:'hl_1',label:'1. Vertrek Garage',defH:'17',defM:'15'}, {id:'hl_2',label:'2. Voorstaan Best.',defH:'17',defM:'45'}, {id:'hl_3',label:'3. Vertrek Best.',defH:'18',defM:'00',trigger:true,style:'highlight-time'}, {id:'hl_4',label:'4. Aankomst Klant',defH:'18',defM:'45'}, {id:'hl_5',label:'5. Retour Garage',defH:'19',defM:'15'} ];
    const tijdVeldenMeerDag1 = [ {id:'md_1',label:'1. Vertrek Garage',defH:'08',defM:'00'}, {id:'md_2',label:'2. Aankomst Locatie',defH:'14',defM:'00'} ];
    const tijdVeldenMeerDagEind = [ {id:'md_3',label:'1. Vertrek Locatie',defH:'12',defM:'00'}, {id:'md_4',label:'2. Aankomst Garage',defH:'18',defM:'00'} ];

    // WINDOW ONLOAD
    window.onload = function() {
        console.log("App Started V3.30");
        
        // 1. Load Data
        const s = localStorage.getItem('berkhout_v2');
        if(s) {
            try { db = JSON.parse(s); } 
            catch(e) { console.error("Corrupt Data"); db = { klanten: [], ritten: [] }; }
        }
        
        // 2. Repair structure if needed
        if(!db.klanten) db.klanten = [];
        if(!db.ritten) db.ritten = [];
        
        // 3. FORCE SAVE (Fixes the "reset every time" bug)
        localStorage.setItem('berkhout_v2', JSON.stringify(db));

        // 4. Build UI
        bouwBusKiezers();
        bouwTijdLijsten();
        renderMonthButtons();
        updateDashboard();
        renderClientList();
        
        // 5. Set Date
        const t = new Date().toISOString().split('T')[0];
        const rd = document.getElementById('rit_datum');
        if(rd) { rd.value=t; document.getElementById('rit_datum_eind').value=t; }
        rekenUren();
    };

    // --- GOOGLE MAPS ---
    function initMaps() {
        console.log("Google Maps Loaded");
        const o={componentRestrictions:{country:'nl'}};
        ['route-start','route-ophaal','route-eind','route-via1','route-via2','crm-adres'].forEach(id=>{
            const el=document.getElementById(id);
            if(el) new google.maps.places.Autocomplete(el,o).addListener('place_changed', function() {
                if(id==='crm-adres'){
                    const p=this.getPlace();
                    el.value=p.formatted_address||'';
                    let s=''; if(p.address_components)p.address_components.forEach(c=>{if(c.types.includes('locality'))s=c.long_name});
                    if(s)document.getElementById('crm-plaats').value=s;
                } else {
                    berekenRoute();
                }
            });
        });
    }

    // --- FUNCTIES (NU GLOBAAL) ---
    function nav(id){
        document.querySelectorAll('.page-section').forEach(p=>p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    function hardReset() {
        if(confirm("WEET JE HET ZEKER? Alle data wordt gewist.")) {
            localStorage.removeItem('berkhout_v2');
            location.reload();
        }
    }

    // CRM
    function nieuwKlantScherm(){
        appState.activeClientId = null;
        document.getElementById('crm-title').innerText = "Nieuwe Klant";
        ['crm-naam','crm-adres','crm-plaats','crm-tel','crm-deb'].forEach(id => {
            if(document.getElementById(id)) document.getElementById(id).value = '';
        });
        document.getElementById('crm-contacts-container').innerHTML = '';
        addContactRow();
        switchCrmView(true);
    }

    function editClient(id){
        const k = db.klanten.find(x => x.id == id);
        if(!k) return;
        appState.activeClientId = id;
        document.getElementById('crm-title').innerText = "Klant Bewerken";
        document.getElementById('crm-naam').value = k.naam || '';
        document.getElementById('crm-adres').value = k.adres || '';
        document.getElementById('crm-plaats').value = k.plaats || '';
        document.getElementById('crm-tel').value = k.tel || '';
        document.getElementById('crm-deb').value = k.debiteurnr || '';
        
        const c = document.getElementById('crm-contacts-container');
        c.innerHTML = '';
        if(k.contactpersonen && k.contactpersonen.length > 0) {
            k.contactpersonen.forEach(cp => addContactRow(cp));
        } else {
            addContactRow();
        }
        switchCrmView(true);
    }

    function saveClient(){
        const naam = document.getElementById('crm-naam').value;
        if(!naam){ alert("Naam verplicht"); return; }
        
        const contacts = [];
        document.querySelectorAll('.contact-row').forEach(row => {
            const inputs = row.querySelectorAll('input');
            if(inputs[0].value) {
                contacts.push({naam: inputs[0].value, email: inputs[1].value, tel: inputs[2].value, mob: inputs[3].value});
            }
        });
        
        const data = {
            id: appState.activeClientId || Date.now(),
            naam: naam,
            adres: document.getElementById('crm-adres').value,
            plaats: document.getElementById('crm-plaats').value,
            tel: document.getElementById('crm-tel').value,
            debiteurnr: document.getElementById('crm-deb').value,
            contactpersonen: contacts
        };
        
        if(appState.activeClientId) {
            const idx = db.klanten.findIndex(x => x.id == appState.activeClientId);
            if(idx > -1) db.klanten[idx] = data; else db.klanten.push(data);
        } else {
            db.klanten.push(data);
        }
        
        localStorage.setItem('berkhout_v2', JSON.stringify(db));
        renderClientList();
        terugNaarLijst();
    }

    function renderClientList(){
        const q = document.getElementById('crm-search').value.toLowerCase();
        const b = document.getElementById('crm-table-body');
        b.innerHTML = '';
        
        db.klanten.filter(k => (k.naam && k.naam.toLowerCase().includes(q)) || (k.plaats && k.plaats.toLowerCase().includes(q)))
        .forEach(k => {
            b.innerHTML += `<tr><td style="font-weight:bold;">${k.naam}</td><td>${k.plaats||'-'}</td><td>${k.contactpersonen[0]?.email||'-'}</td><td>${k.tel||'-'}</td><td style="text-align:center; display:flex; gap:5px; justify-content:center;"><button class="action-btn" onclick="startOfferte(${k.id})"><i class="fa-solid fa-calculator"></i></button><button class="action-btn" onclick="editClient('${k.id}')"><i class="fa-solid fa-pen"></i></button></td></tr>`;
        });
    }

    function addContactRow(d={}){
        const div = document.createElement('div');
        div.className = 'contact-row';
        div.innerHTML = `<input type="text" placeholder="Naam" value="${d.naam||''}"><input type="text" placeholder="Email" value="${d.email||''}"><input type="text" placeholder="Tel" value="${d.tel||''}"><input type="text" placeholder="Mobiel" value="${d.mob||''}"><button class="btn-trash" onclick="this.parentElement.remove()"><i class="fa-solid fa-trash"></i></button>`;
        document.getElementById('crm-contacts-container').appendChild(div);
    }

    function switchCrmView(s){
        document.getElementById('crm-list-view').classList.toggle('hidden', s);
        document.getElementById('crm-detail-view').classList.toggle('hidden', !s);
    }
    function terugNaarLijst(){switchCrmView(false);}

    // CALCULATOR
    function selectCalcClient(id){
        const k = db.klanten.find(x=>x.id==id);
        if(!k) return;
        document.getElementById('calc-klant-zoek').value=k.naam;
        document.getElementById('calc-klant-id').value=k.id;
        document.getElementById('calc-klant-results').style.display='none';
        document.getElementById('route-ophaal').value=k.adres||k.plaats;
        
        const d=document.getElementById('klant-details');
        d.style.display='block';
        d.innerHTML=`<b>${k.naam}</b><br>${k.adres}, ${k.plaats}`;
        
        const s=document.getElementById('calc-contact');
        s.innerHTML='<option value="">-- Kies CP --</option>';
        if(k.contactpersonen) k.contactpersonen.forEach((c,i)=>{s.innerHTML+=`<option value="${i}">${c.naam}</option>`});
        
        berekenRoute();
    }

    function filterCalcClients(){
        const q=document.getElementById('calc-klant-zoek').value.toLowerCase();
        const r=document.getElementById('calc-klant-results');
        r.innerHTML='';
        if(q.length<2){r.style.display='none';return;}
        
        const f=db.klanten.filter(k=>k.naam.toLowerCase().includes(q)||k.plaats.toLowerCase().includes(q));
        if(f.length>0){
            r.style.display='block';
            f.forEach(k=>{
                const d=document.createElement('div'); d.className='search-item';
                d.innerHTML=`<b>${k.naam}</b> <small>(${k.plaats})</small>`;
                d.onclick=()=>selectCalcClient(k.id);
                r.appendChild(d);
            });
        } else r.style.display='none';
    }

    // MAPS & REKENEN
    function berekenRoute(){
        const s=document.getElementById('route-start').value;
        const o=document.getElementById('route-ophaal').value;
        const e=document.getElementById('route-eind').value;
        if(!s||!o||!e)return;
        
        // Check if google is ready
        if(typeof google === 'undefined' || !google.maps) { console.log("Maps not loaded yet"); return; }

        const w=[{location:o,stopover:true}];
        if(document.getElementById('route-via1').value)w.push({location:document.getElementById('route-via1').value,stopover:true});
        if(document.getElementById('route-via2').value)w.push({location:document.getElementById('route-via2').value,stopover:true});
        
        const ds=new google.maps.DirectionsService();
        ds.route({origin:s,destination:e,waypoints:w,travelMode:'DRIVING'},(r,st)=>{
            if(st==='OK'){
                const l=r.routes[0].legs;
                aanrijSec=l[0].duration.value;
                let rd=0; let td=0;
                l.forEach((lg,i)=>{td+=lg.distance.value; if(i>0)rd+=lg.duration.value;});
                ritSec=rd;
                enkeleReisKM=Math.round(td/1000);
                document.getElementById('info-aanrij').innerText=`${Math.round(aanrijSec/60)} min`;
                document.getElementById('info-rit').innerText=`${Math.round(ritSec/60)} min`;
                syncTijden(); rekenUren();
            }
        });
    }

    function rekenPrijs(){
        const u=parseFloat(document.getElementById('uren-display').innerText)||0;
        const km=window.berekendeTotaalKM||0;
        const costParking=parseFloat(document.getElementById('cost-parking').value)||0;
        const costToll=parseFloat(document.getElementById('cost-toll').value)||0;
        const costCat=parseFloat(document.getElementById('cost-catering').value)||0;
        const profitCorrection=parseFloat(document.getElementById('profit-correction').value)||0;

        let kt=0;let b=0;document.querySelectorAll('.bus-check').forEach(x=>{if(x.checked){kt+=busOpties[x.value].prijs;b++;}});
        
        if(b===0){document.getElementById('prijs-display').innerText='€ 0,00';return;}
        
        let baseCost=(km*kt)+(u*33*b);
        let totalCostPrice=baseCost+costParking+costToll+costCat;
        let baseSalesPrice=totalCostPrice/0.75; 
        let finalSalesPriceEx=baseSalesPrice+profitCorrection;
        let finalSalesPriceIncl=finalSalesPriceEx*1.09;
        
        let e=Math.ceil(finalSalesPriceIncl/25)*25; if(e<200)e=200; 
        let eb=e/1.09; 
        let btw=e-eb;
        let actualProfit=eb-totalCostPrice;

        document.getElementById('prijs-display').innerText='€ '+e.toLocaleString('nl-NL',{minimumFractionDigits:2});
        document.getElementById('btw-display').innerText='BTW (9%): € '+btw.toLocaleString('nl-NL',{minimumFractionDigits:2,maximumFractionDigits:2});
        document.getElementById('live-profit').innerText='€ '+Math.round(actualProfit).toLocaleString('nl-NL');
    }

    function opslaan(){
        // De fix: updateDashboard zat hierin verstopt maar bestond niet in scope
        
        const type=document.getElementById('rit-type').value; 
        let av=tijdVeldenStandaard; 
        if(type==='brenghaal')av=[...tijdVeldenBrengen,...tijdVeldenHalen]; 
        if(type==='meerdaagse')av=[...tijdVeldenMeerDag1,...tijdVeldenMeerDagEind];
        
        let ot={}; 
        av.forEach(v=>{ot[v.id]=`${document.getElementById('h_'+v.id).value}:${document.getElementById('m_'+v.id).value}`});
        
        const rd=document.getElementById('rit_datum').value;
        
        const costs = {
            parking: document.getElementById('cost-parking').value,
            toll: document.getElementById('cost-toll').value,
            catering: document.getElementById('cost-catering').value,
            correction: document.getElementById('profit-correction').value
        };

        const data={
            datum:rd,
            klant:document.getElementById('calc-klant-zoek').value||'Onbekend',
            dest:document.getElementById('route-eind').value,
            prijs:document.getElementById('prijs-display').innerText, 
            profit:document.getElementById('live-profit').innerText,
            type:type,
            status:(actieveRitIndex>-1?db.ritten[actieveRitIndex].status:{offerte:false,bevestiging:false,opdracht:false,factuur:false,betaald:false}),
            history:{
                offerte:document.getElementById('calc-date-offerte').value,
                bevestiging:document.getElementById('calc-date-bevestiging').value,
                factuur:document.getElementById('calc-date-factuur').value
            },
            details:{
                rit_datum:rd,
                rit_datum_eind:document.getElementById('rit_datum_eind').value,
                klantId:document.getElementById('calc-klant-id').value,
                contactIdx:document.getElementById('calc-contact').value,
                pax:document.getElementById('calc-pax').value,
                bussen:Array.from(document.querySelectorAll('.bus-check:checked')).map(b=>b.value),
                route:{
                    start:document.getElementById('route-start').value,
                    ophaal:document.getElementById('route-ophaal').value,
                    via1:document.getElementById('route-via1').value,
                    via2:document.getElementById('route-via2').value,
                    eind:document.getElementById('route-eind').value
                },
                tijden:ot,
                type:type,
                costs:costs
            }
        };
        
        if(actieveRitIndex>-1) db.ritten[actieveRitIndex]=data; else db.ritten.unshift(data);
        localStorage.setItem('berkhout_v2',JSON.stringify(db));
        
        updateDashboard(); 
        resetForm(); 
        nav('dashboard');
    }

    function updateDashboard(){
        const b=document.getElementById('rit-tabel-body');
        const e=document.getElementById('empty-state');
        if(!b) return;
        b.innerHTML='';
        
        const dayNames = ['Zo','Ma','Di','Wo','Do','Vr','Za'];
        
        db.ritten.forEach((r,idx)=>{
            if(!r.status)r.status={offerte:false,bevestiging:false,opdracht:false,factuur:false,betaald:false};
            
            const d=new Date(r.datum);
            const dayName = dayNames[d.getDay()];
            const ds=`${dayName} ${d.getDate().toString().padStart(2,'0')}-${(d.getMonth()+1).toString().padStart(2,'0')}`;
            
            let tr=document.createElement('tr');
            tr.innerHTML=`
                <td><button class="action-btn" onclick="laadRit(${idx})"><i class="fa-solid fa-pen"></i></button></td>
                <td style="font-weight:bold;color:var(--primary);font-size:12px;">${ds}</td>
                <td><span class="tag tag-blue">${r.type}</span></td>
                <td>${r.klant}</td>
                <td>${r.dest||'-'}</td>
                <td style="text-align:right;font-weight:bold;">${r.prijs}</td>
                ${['offerte','bevestiging','opdracht','factuur','betaald'].map(s=>`
                    <td class="status-cell" onclick="toggleStatus(${idx},'${s}')">
                        <i class="fa-solid fa-circle-check status-icon ${r.status[s]?'done':''}"></i>
                    </td>`).join('')}
            `;
            b.appendChild(tr);
        });
        
        e.style.display = (db.ritten.length === 0) ? 'block' : 'none';
    }

    function toggleStatus(index, veld) {
        if(veld==='offerte'&&!db.ritten[index].status.offerte){openOfferteModal(index);return;}
        db.ritten[index].status[veld]=!db.ritten[index].status[veld];
        localStorage.setItem('berkhout_v2',JSON.stringify(db));
        updateDashboard();
    }

    // HELPERS (REST)
    function laadRit(index){
        const r=db.ritten[index]; if(!r.details){alert("Oude rit");return;}
        actieveRitIndex=index;
        
        document.getElementById('rit_datum').value=r.details.rit_datum; 
        document.getElementById('rit_datum_eind').value=r.details.rit_datum_eind;
        if(r.details.klantId) selectCalcClient(r.details.klantId);
        if(r.details.contactIdx) document.getElementById('calc-contact').value=r.details.contactIdx;
        
        document.getElementById('calc-pax').value=r.details.pax||'';
        document.querySelectorAll('.bus-check').forEach(b=>b.checked=false);
        r.details.bussen.forEach(v=>{ const c=document.querySelector(`.bus-check[value="${v}"]`); if(c)c.checked=true; });
        
        document.getElementById('route-start').value=r.details.route.start;
        document.getElementById('route-ophaal').value=r.details.route.ophaal;
        document.getElementById('route-via1').value=r.details.route.via1;
        document.getElementById('route-via2').value=r.details.route.via2;
        document.getElementById('route-eind').value=r.details.route.eind;
        if(r.details.route.via1 || r.details.route.via2) toggleVia();
        
        document.getElementById('rit-type').value=r.details.type; 
        wisselTijdLijst();
        
        for(let id in r.details.tijden){
            const [u,m]=r.details.tijden[id].split(':');
            const h=document.getElementById('h_'+id);
            const mn=document.getElementById('m_'+id);
            if(h&&mn){h.value=u;mn.value=m;}
        }
        
        const c = r.details.costs || {};
        document.getElementById('cost-parking').value = c.parking || 0;
        document.getElementById('cost-toll').value = c.toll || 0;
        document.getElementById('cost-catering').value = c.catering || 0;
        document.getElementById('profit-correction').value = c.correction || 0;

        const h = r.history || {};
        document.getElementById('calc-date-offerte').value = h.offerte || '';
        document.getElementById('calc-date-bevestiging').value = h.bevestiging || '';
        document.getElementById('calc-date-factuur').value = h.factuur || '';

        nav('calculatie'); rekenUren();
    }

    function syncDates(){ document.getElementById('rit_datum_eind').value=document.getElementById('rit_datum').value; updateDateDisplays(); rekenUren(); }
    function updateDateDisplays() {
        const d1=document.getElementById('rit_datum').value; const d2=document.getElementById('rit_datum_eind').value;
        const o={weekday:'long',year:'numeric',month:'long',day:'numeric'};
        if(d1) document.getElementById('display-start-date').innerText=new Date(d1).toLocaleDateString('nl-NL',o);
        if(d2) document.getElementById('display-end-date').innerText=new Date(d2).toLocaleDateString('nl-NL',o);
    }
    
    function startOfferte(id){resetForm();nav('calculatie');selectCalcClient(id);}
    function changeYear(d){appState.currentYear+=d;renderMonthButtons();updateDashboard();}
    function selectMonth(m){appState.currentMonth=m;renderMonthButtons();updateDashboard();}
    function renderMonthButtons(){document.getElementById('display-year').innerText=appState.currentYear;const c=document.getElementById('month-buttons');let h=`<button class="month-btn ${appState.currentMonth===-1?'active':''}" onclick="selectMonth(-1)">Alles</button>`;maanden.forEach((m,i)=>{h+=`<button class="month-btn ${appState.currentMonth===i?'active':''}" onclick="selectMonth(${i})">${m}</button>`;});c.innerHTML=h;}
    function toggleVia(){document.getElementById('via-container').classList.toggle('hidden');}
    
    function closeModal(id){document.getElementById(id).classList.add('hidden');}
    function openOfferteModal(i){appState.activeRitId=i;const r=db.ritten[i];const k=db.klanten.find(x=>x.id==r.details.klantId);let cp="Geen CP";if(r.details.contactIdx!==""&&k&&k.contactpersonen[r.details.contactIdx])cp=k.contactpersonen[r.details.contactIdx].naam;document.getElementById('offerte-modal-content').innerHTML=`<div style="border-bottom:1px solid #eee;padding-bottom:10px;margin-bottom:10px;"><h3 style="margin:0;">${k?k.naam:r.klant}</h3><div style="font-size:13px;color:#666;">${k?k.adres+', '+k.plaats:''}<br>T.a.v: ${cp}</div></div><div style="background:#f9fafb;padding:15px;border-radius:8px;"><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:13px;"><div><b>Vertrek:</b> ${r.datum}</div><div><b>Pax:</b> ${r.details.pax||'-'}</div><div><b>Van:</b> ${r.details.route.ophaal}</div><div><b>Naar:</b> ${r.dest}</div></div><div style="margin-top:15px;font-size:18px;font-weight:bold;text-align:right;">Totaal: ${r.prijs}</div></div>`;document.getElementById('offerte-note-text').value=r.internal_notes||'';document.getElementById('offerte-modal').classList.remove('hidden');}
    function toggleNote(){const b=document.getElementById('offerte-note-box');b.style.display=(b.style.display==='block')?'none':'block';}
    function saveInternalNote(){if(appState.activeRitId!==null){db.ritten[appState.activeRitId].internal_notes=document.getElementById('offerte-note-text').value;localStorage.setItem('berkhout_v2',JSON.stringify(db));alert('Opgeslagen');}}
    function confirmOfferte(){if(appState.activeRitId!==null){db.ritten[appState.activeRitId].status.offerte=true;localStorage.setItem('berkhout_v2',JSON.stringify(db));updateDashboard();closeModal('offerte-modal');}}
    function printOfferte(){if(appState.activeRitId===null)return;const r=db.ritten[appState.activeRitId];const k=db.klanten.find(x=>x.id==r.details.klantId);let cp="";if(r.details.contactIdx!==""&&k&&k.contactpersonen[r.details.contactIdx])cp=k.contactpersonen[r.details.contactIdx].naam;const d=new Date().toLocaleDateString('nl-NL',{day:'numeric',month:'long',year:'numeric'});const rd=new Date(r.datum).toLocaleDateString('nl-NL',{day:'numeric',month:'long',year:'numeric'});const c=`<html><head><title>Offerte</title><style>body{font-family:Arial,sans-serif;padding:40px;color:#333;line-height:1.5;max-width:800px;margin:0 auto;}.header{display:flex;justify-content:space-between;margin-bottom:50px;}.logo-area{font-size:24px;font-weight:bold;color:#004a99;}.sender-info{font-size:12px;color:#666;text-align:right;}.receiver-info{margin-bottom:40px;font-size:14px;}.meta-info{display:flex;justify-content:space-between;margin-bottom:30px;font-size:14px;border-bottom:2px solid #eee;padding-bottom:10px;}.subject{font-size:18px;font-weight:bold;margin-bottom:20px;color:#004a99;}.table{width:100%;border-collapse:collapse;margin-bottom:30px;font-size:14px;}.table th{text-align:left;border-bottom:1px solid #ccc;padding:8px;}.table td{border-bottom:1px solid #eee;padding:8px;}.total-block{text-align:right;font-size:16px;margin-top:20px;}.total-price{font-size:22px;font-weight:bold;color:#004a99;}.footer{margin-top:60px;font-size:11px;color:#888;text-align:center;border-top:1px solid #eee;padding-top:20px;}</style></head><body><div class="header"><div class="logo-area">BERKHOUT REIZEN</div><div class="sender-info">Berkhout Reizen<br>Industrieweg 99J<br>7202 CA Zutphen<br>info@berkhoutreizen.nl</div></div><div class="receiver-info"><strong>${k?k.naam:r.klant}</strong><br>${cp?'T.a.v. '+cp+'<br>':''}${k?k.adres+'<br>'+k.plaats:''}</div><div class="meta-info"><div><strong>Datum:</strong> ${d}</div><div><strong>Geldig tot:</strong> 14 dagen na dagtekening</div></div><div class="subject">Offerte: Vervoer naar ${r.dest}</div><p>Geachte relatie,</p><p>Hartelijk dank voor uw aanvraag. Hierbij doen wij u graag de volgende aanbieding.</p><table class="table"><tr><th>Omschrijving</th><th>Details</th></tr><tr><td>Vertrekdatum</td><td>${rd}</td></tr><tr><td>Vertreklocatie</td><td>${r.details.route.ophaal}</td></tr><tr><td>Bestemming</td><td>${r.dest}</td></tr><tr><td>Type Reis</td><td>${r.type}</td></tr><tr><td>Aantal Personen</td><td>${r.details.pax||'-'}</td></tr></table><div class="total-block">Totaalbedrag (incl. 9% BTW):<br><span class="total-price">${r.prijs}</span></div><p style="margin-top:40px;">Met vriendelijke groet,<br><br>Berkhout Reizen</p><div class="footer">Op al onze diensten zijn de Algemene Vervoersvoorwaarden van toepassing. KVK: 12345678.</div></body></html>`;const w=window.open('','_blank');w.document.write(c);w.document.close();setTimeout(()=>{w.print()},500);}
</script>
</body>
</html>
