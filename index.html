<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Berkhout Ritregistratie</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f0f0f5; margin: 0; padding: 15px; color: #333; -webkit-tap-highlight-color: transparent; }
        
        /* -- MENU STIJLEN -- */
        #menu-scherm { display: flex; flex-direction: column; gap: 15px; padding-top: 10px; max-width: 600px; margin: 0 auto; }
        .logo-container { text-align: center; margin-bottom: 20px; }
        .logo-img { max-width: 100%; height: auto; max-height: 85px; }
        
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .menu-blok {
            background: white; border-radius: 12px; padding: 25px 10px; text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 2px solid #e0e0e0;
            font-size: 16px; font-weight: bold; color: #0056b3; transition: 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100px;
        }
        .menu-blok:active { background: #e7f3ff; border-color: #0056b3; transform: scale(0.98); }
        .stremming-blok { border-color: #f5c6cb; color: #dc3545; grid-column: span 2; }
        
        /* -- APP STIJLEN -- */
        #app-scherm { display: none; max-width: 600px; margin: 0 auto; }
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        
        .header-balk { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; }
        .btn-terug { background: #6c757d; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-weight: bold; font-size: 14px; }
        .rit-titel { font-size: 18px; font-weight: bold; color: #0056b3; text-transform: uppercase; }

        label { display: block; font-size: 11px; font-weight: 700; color: #666; text-transform: uppercase; margin-bottom: 5px; letter-spacing: 0.5px; }
        input, select {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; background: #f9f9f9; margin-bottom: 12px; appearance: none;
        }
        input:focus, select:focus { border-color: #0056b3; background: #fff; outline: none; }

        /* Rij Styling */
        .rit-rij { padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .rit-rij:last-child { border-bottom: none; }
        .locatie-naam { font-weight: 700; margin-bottom: 8px; font-size: 15px; color: #222; }
        
        .tussenkop {
            background: #e7f3ff; color: #0056b3; padding: 8px 12px; border-radius: 6px; 
            font-weight: bold; margin: 20px -15px 10px -15px; text-align: center; border-top: 1px solid #b3d7ff; border-bottom: 1px solid #b3d7ff;
        }

        /* Steppers (Plus/Min knoppen) */
        .selector-row { display: flex; gap: 10px; margin-bottom: 8px; align-items: center; }
        .control-label { min-width: 35px; font-size: 10px; color: #999; font-weight: bold; }
        
        .stepper { display: flex; align-items: center; background: #f0f0f5; border-radius: 8px; flex: 1; overflow: hidden; border: 1px solid #e0e0e0; }
        .t-btn { background: white; color: #0056b3; border: none; width: 45px; height: 44px; font-size: 22px; font-weight: bold; border-right: 1px solid #e0e0e0; cursor: pointer; }
        .t-btn:last-child { border-right: none; border-left: 1px solid #e0e0e0; }
        .t-btn:active { background: #e7f3ff; }
        
        .val-display { flex: 1; text-align: center; font-weight: 600; font-size: 16px; line-height: 44px; }
        .km-field { border: none; background: transparent; text-align: center; font-weight: 600; font-size: 16px; width: 100%; padding: 0; margin: 0; height: 44px; }

        /* Footer & Alerts */
        .totaal-sectie { background: #f8fbff; padding: 15px; border-radius: 8px; border: 1px solid #d0e5ff; margin-top: 15px; }
        .totaal-waarde { font-size: 18px; font-weight: bold; color: #0056b3; display: block; margin-bottom: 4px; }
        
        .error-input { border: 2px solid #dc3545 !important; background: #fff5f5 !important; }
        .stremming-box { display: flex; align-items: center; justify-content: space-between; background: #fff3cd; padding: 12px; border-radius: 8px; border: 1px solid #ffeeba; margin-top: 10px; }
        .stremming-box label { margin: 0; color: #856404; text-transform: none; font-size: 14px; }
        
        .btn-verzend { background: #28a745; color: white; width: 100%; padding: 16px; font-size: 18px; font-weight: bold; border: none; border-radius: 10px; margin-top: 15px; box-shadow: 0 2px 5px rgba(40,167,69,0.3); }
        .btn-wis { background: #dc3545; color: white; width: 100%; padding: 12px; font-size: 14px; border: none; border-radius: 8px; margin-top: 30px; opacity: 0.8; }
    </style>
</head>
<body>

    <div id="menu-scherm">
        <div class="logo-container">
            <img src="logo.png" alt="Berkhout Busreizen" class="logo-img">
        </div>
        <div class="menu-grid">
            <div class="menu-blok" onclick="kiesRit('Dagrit')">‚òÄÔ∏è Dagrit</div>
            <div class="menu-blok" onclick="kiesRit('Enkele rit')">‚û°Ô∏è Enkele rit</div>
            <div class="menu-blok" onclick="kiesRit('Breng en haal')">üîÑ Breng & Haal</div>
            <div class="menu-blok stremming-blok" onclick="kiesRit('Treinstremming')">‚ö†Ô∏è Treinstremming</div>
        </div>
    </div>

    <div id="app-scherm">
        <div class="header-balk">
            <button class="btn-terug" onclick="terugNaarMenu()">‚ùÆ Menu</button>
            <span class="rit-titel" id="titel-weergave">Dagrit</span>
        </div>

        <div class="card">
            <label>Chauffeur</label>
            <select id="chauffeur-naam">
                <option value="">Kies naam...</option>
                <option value="Fred Haan">Fred Haan</option>
                <option value="Fred Stravers">Fred Stravers</option>
                <option value="Gerard Hellewegen">Gerard Hellewegen</option>
                <option value="Hans Roordink">Hans Roordink</option>
                <option value="Hilbert van Dam">Hilbert van Dam</option>
                <option value="Jan Jolink">Jan Jolink</option>
                <option value="Jesse Berkhout">Jesse Berkhout</option>
                <option value="Monique Westerholt">Monique Westerholt</option>
                <option value="Niek Berkhout">Niek Berkhout</option>
            </select>

            <label>Datum</label>
            <input type="date" id="rit-datum" onchange="berekenAlles()">

            <label>Bus nummer</label>
            <select id="bus-nummer">
                <option value="">Kies bus...</option>
                <option value="19">19</option>
                <option value="23">23</option>
                <option value="50">50</option>
                <option value="53">53</option>
                <option value="60">60</option>
                <option value="62">62</option>
                <option value="BZ-TX-98">BZ-TX-98</option>
            </select>

            <label>Klant / Opdracht</label>
            <input type="text" id="klant-naam" placeholder="Naam klant">
            
            <div style="display: flex; gap: 10px;">
                <div style="flex:1"><label>Van</label><input type="text" id="van-plaats"></div>
                <div style="flex:1"><label>Naar</label><input type="text" id="naar-plaats"></div>
            </div>
        </div>

        <div class="card">
            <div id="ritLijst"></div>

            <label style="margin-top:15px;">Einddatum</label>
            <input type="date" id="rit-einddatum" onchange="berekenAlles()">

            <div class="stremming-box">
                <label>‚ö†Ô∏è NS Stremming Tarief</label>
                <input type="checkbox" id="stremming">
            </div>

            <div class="totaal-sectie">
                <span class="totaal-waarde" id="totaalTijd">Diensttijd: 0u 0m</span>
                <span class="totaal-waarde" id="totaalKm">Totaal KM: 0 km</span>
            </div>
            <div id="foutmelding" style="color:#dc3545; font-weight:bold; text-align:center; margin-top:10px; display:none;">‚ö†Ô∏è Controleer tijden of kilometers!</div>
        </div>

        <button id="verzendKnop" class="btn-verzend" onclick="verstuurMail()">VERSTUUR RITDATA</button>
        <button class="btn-wis" onclick="wisAlles()">WIS ALLE VELDEN</button>
    </div>

    <script>
        // CONFIGURATIE VAN DE RITTEN
        const rittenConfig = {
            'Dagrit': [
                "Vertrek garage", "Vertrek klant", "Aankomst bestemming", 
                "Vertrek bestemming", "Retour klant", "Retour garage"
            ],
            'Enkele rit': [
                "Vertrek garage", "Vertrek klant", "Aankomst bestemming", "Retour garage"
            ],
            'Treinstremming': [
                "Vertrek zaak", "1e station", "Laatste station", "Retour zaak"
            ],
            'Breng en haal': [
                "Vertrek garage (Heen)", "Vertrek klant", "Aankomst bestemming", "Retour garage",
                "DIVIDER:Deel 2: Ophalen", // Speciale markering voor de tussenkop
                "Vertrek garage (Terug)", "Vertrek bestemming", "Retour klant", "Retour garage"
            ]
        };

        const standaardtijden = ["08:00", "08:15", "10:00", "16:00", "16:30", "17:00", "22:00", "23:00"];
        let huidigType = "";
        let huidigeRegels = [];

        function init() {
            const vandaag = new Date();
            document.getElementById('rit-datum').valueAsDate = vandaag;
            document.getElementById('rit-einddatum').valueAsDate = vandaag;
        }

        function kiesRit(type) {
            huidigType = type;
            huidigeRegels = rittenConfig[type];
            document.getElementById('titel-weergave').innerText = type;
            
            // Scherm wissel
            document.getElementById('menu-scherm').style.display = 'none';
            document.getElementById('app-scherm').style.display = 'block';

            // Automatisch vinkje bij stremming
            document.getElementById('stremming').checked = (type === 'Treinstremming');

            bouwFormulier();
            berekenAlles();
            window.scrollTo(0,0);
        }

        function terugNaarMenu() {
            if(confirm("Terug naar menu? Je ingevulde gegevens blijven staan.")) {
                document.getElementById('app-scherm').style.display = 'none';
                document.getElementById('menu-scherm').style.display = 'block'; // Gebruik block, niet flex ivm CSS
            }
        }

        function bouwFormulier() {
            let html = "";
            let indexTeller = 0;

            huidigeRegels.forEach((label) => {
                if (label.startsWith("DIVIDER:")) {
                    // Tussenkopje maken
                    let tekst = label.split(":")[1];
                    html += `<div class="tussenkop">${tekst}</div>`;
                } else {
                    // Normale rij maken
                    let tijd = standaardtijden[indexTeller] || "00:00";
                    html += `
                    <div class="rit-rij">
                        <div class="locatie-naam">${label}</div>
                        <div class="selector-row">
                            <div class="control-label">TIJD</div>
                            <div class="stepper" id="box-tijd-${indexTeller}">
                                <button class="t-btn" onclick="pasTijdAan(${indexTeller}, -15)">-</button>
                                <div class="val-display" id="tijd-${indexTeller}">${tijd}</div>
                                <button class="t-btn" onclick="pasTijdAan(${indexTeller}, 15)">+</button>
                            </div>
                        </div>
                        <div class="selector-row">
                            <div class="control-label">KM</div>
                            <div class="stepper" id="box-km-${indexTeller}">
                                <button class="t-btn" onclick="pasKmAan(${indexTeller}, -1)">-</button>
                                <input type="number" id="km-${indexTeller}" class="km-field" placeholder="0" oninput="berekenAlles()">
                                <button class="t-btn" onclick="pasKmAan(${indexTeller}, 1)">+</button>
                            </div>
                        </div>
                    </div>`;
                    indexTeller++;
                }
            });
            document.getElementById('ritLijst').innerHTML = html;
        }

        function pasTijdAan(id, min) {
            let el = document.getElementById(`tijd-${id}`);
            let [u, m] = el.innerText.split(":").map(Number);
            let d = new Date(); d.setHours(u, m + min);
            el.innerText = ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2);
            berekenAlles();
        }

        function pasKmAan(id, delta) {
            let el = document.getElementById(`km-${id}`);
            el.value = (parseInt(el.value) || 0) + delta;
            berekenAlles();
        }

        function berekenAlles() {
            // Tel hoeveel invoervelden er daadwerkelijk zijn (exclusief dividers)
            let aantalVelden = document.querySelectorAll('.km-field').length;
            let kmStanden = [];
            let tijdMinuten = [];
            let fout = false;

            for(let i=0; i < aantalVelden; i++) {
                // Reset errors
                document.getElementById(`box-km-${i}`).classList.remove('error-input');
                
                let kmVal = parseInt(document.getElementById(`km-${i}`).value) || 0;
                kmStanden.push(kmVal);
                
                let [u, m] = document.getElementById(`tijd-${i}`).innerText.split(":").map(Number);
                tijdMinuten.push(u * 60 + m);

                // Check KM oplopend (behalve bij Breng en Haal na de divider, maar dat is lastig te checken
                // We doen een simpele check: is huidige lager dan vorige?
                if (i > 0 && kmVal > 0 && kmVal < kmStanden[i-1]) {
                    // Bij Breng en Haal mag er een gat zitten, maar KM moet altijd oplopen (bus rijdt door)
                    document.getElementById(`box-km-${i}`).classList.add('error-input');
                    fout = true;
                }
            }

            // Totalen berekenen
            let maxKm = Math.max(...kmStanden);
            let minKm = kmStanden.find(k => k > 0) || 0;
            let totaalKm = (maxKm > 0 && minKm > 0) ? (maxKm - minKm) : 0;
            document.getElementById('totaalKm').innerText = `Totaal KM: ${totaalKm} km`;

            // Tijd
            const d1 = new Date(document.getElementById('rit-datum').value);
            const d2 = new Date(document.getElementById('rit-einddatum').value);
            let dagVerschil = Math.round((d2 - d1) / (1000 * 60 * 60 * 24));
            
            // Diensttijd is altijd: (Laatste tijd + dagen) - Eerste tijd
            if (tijdMinuten.length > 0) {
                let startT = tijdMinuten[0];
                let eindT = tijdMinuten[tijdMinuten.length - 1];
                let totaalMin = (eindT + (dagVerschil * 1440)) - startT;
                if (totaalMin < 0) totaalMin = 0;
                
                let uren = Math.floor(totaalMin / 60);
                let min = totaalMin % 60;
                document.getElementById('totaalTijd').innerText = `Diensttijd: ${uren}u ${min}m`;
            }

            // Knoppen blokkeren bij fout
            document.getElementById('foutmelding').style.display = fout ? 'block' : 'none';
            document.getElementById('verzendKnop').style.opacity = fout ? 0.5 : 1;
        }

        function verstuurMail() {
            const chauffeur = document.getElementById('chauffeur-naam').value;
            if (!chauffeur) { alert("‚ö†Ô∏è Kies eerst een chauffeur!"); return; }

            const totaalTijd = document.getElementById('totaalTijd').innerText;
            const totaalKm = document.getElementById('totaalKm').innerText;

            if(confirm(`Bevestig verzenden:\n\nType: ${huidigType}\nChauffeur: ${chauffeur}\n${totaalTijd}\n${totaalKm}\n\nKlopt dit?`)) {
                
                let body = `RITREGISTRATIE BERKHOUT\n----------------------\n`;
                body += `Type: ${huidigType.toUpperCase()}\n`;
                body += `Chauffeur: ${chauffeur}\n`;
                body += `Datum: ${document.getElementById('rit-datum').value}\n`;
                body += `Bus: ${document.getElementById('bus-nummer').value || '-'}\n`;
                body += `Klant: ${document.getElementById('klant-naam').value || '-'}\n`;
                body += `Traject: ${document.getElementById('van-plaats').value || '-'}  ->  ${document.getElementById('naar-plaats').value || '-'}\n`;
                body += `Stremming: ${document.getElementById('stremming').checked ? 'JA' : 'Nee'}\n\n`;
                
                // Loop door de regels heen en pak de waardes
                let veldTeller = 0;
                huidigeRegels.forEach(regel => {
                    if(regel.startsWith("DIVIDER:")) {
                        body += `\n--- ${regel.split(":")[1]} ---\n`;
                    } else {
                        let tijd = document.getElementById(`tijd-${veldTeller}`).innerText;
                        let km = document.getElementById(`km-${veldTeller}`).value || '-';
                        body += `${regel}: ${tijd} | KM: ${km}\n`;
                        veldTeller++;
                    }
                });

                body += `\n----------------------\n`;
                body += `${totaalTijd}\n`;
                body += `${totaalKm}`;

                window.location.href = `mailto:info@taxiberkhout.nl?subject=Ritregistratie ${huidigType} - ${chauffeur}&body=${encodeURIComponent(body)}`;
            }
        }

        function wisAlles() {
            if(confirm("Alles wissen en opnieuw beginnen?")) {
                location.reload();
            }
        }

        init();
    </script>
</body>
</html>
