<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Berkhout Ritregistratie</title>
    <style>
        body { font-family: sans-serif; background: #f0f0f5; margin: 0; padding: 15px; color: #333; }
        .logo-container { text-align: center; margin-bottom: 20px; }
        .logo-img { max-width: 100%; height: auto; max-height: 80px; }
        .card { background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h2 { font-size: 16px; margin: 0 0 12px 0; color: #0056b3; border-bottom: 2px solid #f0f0f5; padding-bottom: 5px; }
        label { display: block; font-size: 11px; font-weight: bold; color: #666; text-transform: uppercase; margin-bottom: 4px; }
        input[type="text"], input[type="date"], input[type="number"], select {
            width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; background: #fff; margin-bottom: 12px;
        }
        .error-input { border: 2px solid #dc3545 !important; background: #fff8f8 !important; }
        .rit-rij { padding: 12px 0; border-bottom: 1px solid #eee; }
        .locatie-naam { font-weight: bold; margin-bottom: 8px; font-size: 14px; }
        .selector-row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
        .control-label { min-width: 40px; font-size: 10px; color: #888; font-weight: bold; }
        .stepper { display: flex; align-items: center; background: #eee; border-radius: 6px; flex: 1; overflow: hidden; border: 1px solid #ddd; }
        .t-btn { background: #0056b3; color: white; border: none; width: 45px; height: 42px; font-size: 18px; font-weight: bold; }
        .val-display { flex: 1; text-align: center; font-weight: bold; font-size: 15px; background: white; line-height: 42px; height: 42px; }
        .km-field { border: none; width: 100%; text-align: center; font-size: 16px; font-weight: bold; padding: 10px 0; background: transparent; }
        .stremming-box { display: flex; align-items: center; justify-content: space-between; background: #fff3cd; padding: 12px; border-radius: 8px; border: 1px solid #ffeeba; margin-top: 10px; }
        .stremming-box label { margin: 0; color: #856404; font-size: 14px; text-transform: none; }
        .totaal-sectie { background: #e7f3ff; padding: 15px; border-radius: 8px; border: 1px solid #b3d7ff; margin-top: 15px; }
        .warning-msg { color: #dc3545; font-size: 12px; font-weight: bold; margin-top: 10px; display: none; text-align: center; }
        .btn-verzend { background: #28a745; color: white; width: 100%; padding: 18px; font-size: 18px; font-weight: bold; border: none; border-radius: 12px; margin-top: 15px; }
        .btn-wis { background: #dc3545; color: white; width: 100%; padding: 10px; font-size: 14px; border: none; border-radius: 8px; margin-top: 25px; opacity: 0.7; }
    </style>
</head>
<body>

    <div class="logo-container">
        <img src="logo.png" alt="Berkhout Busreizen" class="logo-img">
    </div>

    <div class="card">
        <h2>Chauffeur & Rit</h2>
        <select id="chauffeur-naam">
            <option value="">Kies chauffeur...</option>
            <option value="Fred Haan">Fred Haan</option>
            <option value="Fred Stravers">Fred Stravers</option>
            <option value="Gerard Hellewegen">Gerard Hellewegen</option>
            <option value="Hans Roordink">Hans Roordink</option>
            <option value="Hilbert van Dam">Hilbert van Dam</option>
            <option value="Jan Jolink">Jan Jolink</option>
            <option value="Jesse Berkhout">Jesse Berkhout</option>
            <option value="Monique Westerholt">Monique Westerholt</option>
            <option value="Niek Berkhout">Niek Berkhout</option>
        </select>

        <label>Begindatum</label>
        <input type="date" id="rit-datum" onchange="berekenAlles()">

        <label>Bus nummer</label>
        <select id="bus-nummer">
            <option value="">Kies bus...</option>
            <option value="19">19</option>
            <option value="23">23</option>
            <option value="50">50</option>
            <option value="53">53</option>
            <option value="60">60</option>
            <option value="62">62</option>
        </select>

        <label>Klant</label>
        <input type="text" id="klant-naam" placeholder="Naam klant">

        <div style="display: flex; gap: 10px;">
            <div style="flex: 1;"><label>Van</label><input type="text" id="van-plaats"></div>
            <div style="flex: 1;"><label>Naar</label><input type="text" id="naar-plaats"></div>
        </div>
    </div>

    <div class="card">
        <h2>Tijden & KM-standen</h2>
        <div id="ritLijst"></div>
        
        <label>Einddatum</label>
        <input type="date" id="rit-einddatum" onchange="berekenAlles()">

        <div class="stremming-box">
            <label for="stremming">⚠️ Treinstremming (NS)</label>
            <input type="checkbox" id="stremming">
        </div>

        <div class="totaal-sectie">
            <div id="totaalTijd" style="font-weight: bold;">Diensttijd: 0u 0m</div>
            <div id="totaalKm" style="font-weight: bold;">Totaal KM: 0 km</div>
        </div>
        <div id="foutmelding" class="warning-msg">⚠️ Let op: Tijden of KM-standen lopen niet op!</div>
    </div>

    <button id="verzendKnop" class="btn-verzend" onclick="verstuurMail()">VERSTUUR RITDATA</button>
    <button class="btn-wis" onclick="wisAlles()">WIS ALLE VELDEN</button>

    <script>
        const locaties = ["Vertrek garage", "Vertrek klant", "Aankomst bestemming", "Vertrek bestemming", "Retour klant", "Retour garage"];
        const standaardTijden = ["08:00", "08:15", "10:00", "16:00", "16:30", "17:00"];

        function initApp() {
            const vandaag = new Date();
            document.getElementById('rit-datum').valueAsDate = vandaag;
            document.getElementById('rit-einddatum').valueAsDate = vandaag;
            let html = "";
            locaties.forEach((loc, index) => {
                html += `<div class="rit-rij">
                    <div class="locatie-naam">${loc}</div>
                    <div class="selector-row">
                        <div class="control-label">TIJD</div>
                        <div class="stepper" id="box-tijd-${index}">
                            <button class="t-btn" onclick="pasTijdAan(${index}, -15)">-</button>
                            <div class="val-display" id="tijd-${index}">${standaardTijden[index]}</div>
                            <button class="t-btn" onclick="pasTijdAan(${index}, 15)">+</button>
                        </div>
                    </div>
                    <div class="selector-row">
                        <div class="control-label">KM</div>
                        <div class="stepper" id="box-km-${index}">
                            <button class="t-btn" onclick="pasKmAan(${index}, -1)">-</button>
                            <input type="number" id="km-${index}" class="km-field" placeholder="0" oninput="berekenAlles()">
                            <button class="t-btn" onclick="pasKmAan(${index}, 1)">+</button>
                        </div>
                    </div>
                </div>`;
            });
            document.getElementById('ritLijst').innerHTML = html;
            berekenAlles();
        }

        function pasTijdAan(id, min) {
            let display = document.getElementById(`tijd-${id}`);
            let t = display.innerText.split(":");
            let d = new Date();
            d.setHours(parseInt(t[0]), parseInt(t[1]) + min);
            display.innerText = ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2);
            berekenAlles();
        }

        function pasKmAan(id, delta) {
            let el = document.getElementById(`km-${id}`);
            el.value = (parseInt(el.value) || 0) + delta;
            berekenAlles();
        }

        function berekenAlles() {
            let heeftFout = false;
            let kmStanden = [];
            let tijdMinuten = [];

            for(let i=0; i<6; i++) {
                kmStanden.push(parseInt(document.getElementById(`km-${i}`).value) || 0);
                let [h, m] = document.getElementById(`tijd-${i}`).innerText.split(":").map(Number);
                tijdMinuten.push(h * 60 + m);
            }

            const d1 = new Date(document.getElementById('rit-datum').value);
            const d2 = new Date(document.getElementById('rit-einddatum').value);
            const isNachtrit = d2 > d1;

            for(let i=0; i<6; i++) {
                document.getElementById(`box-km-${i}`).classList.remove('error-input');
                document.getElementById(`box-tijd-${i}`).classList.remove('error-input');
                if(i > 0) {
                    if(kmStanden[i] > 0 && kmStanden[i] < kmStanden[i-1]) {
                        document.getElementById(`box-km-${i}`).classList.add('error-input');
                        heeftFout = true;
                    }
                    if(!isNachtrit && tijdMinuten[i] < tijdMinuten[i-1]) {
                        document.getElementById(`box-tijd-${i}`).classList.add('error-input');
                        heeftFout = true;
                    }
                }
            }

            document.getElementById('foutmelding').style.display = heeftFout ? 'block' : 'none';
            document.getElementById('verzendKnop').disabled = heeftFout;
            document.getElementById('verzendKnop').style.opacity = heeftFout ? '0.5' : '1';

            let maxKm = Math.max(...kmStanden);
            let minKm = kmStanden.find(k => k > 0) || 0;
            document.getElementById('totaalKm').innerText = `Totaal KM: ${maxKm - minKm} km`;

            let dagVerschil = Math.round((d2 - d1) / (1000 * 60 * 60 * 24));
            let totaalMin = (tijdMinuten[5] + (dagVerschil * 1440)) - tijdMinuten[0];
            document.getElementById('totaalTijd').innerText = `Diensttijd: ${Math.max(0, Math.floor(totaalMin/60))}u ${Math.max(0, totaalMin%60)}m`;
        }

        function verstuurMail() {
            const chauffeur = document.getElementById('chauffeur-naam').value;
            if (!chauffeur) {
                alert("⚠️ Selecteer eerst je naam onder 'Chauffeur'.");
                return;
            }

            const tTijd = document.getElementById('totaalTijd').innerText;
            const tKm = document.getElementById('totaalKm').innerText;

            const bevestiging = confirm(
                `Gegevens controleren:\n\n` +
                `Chauffeur: ${chauffeur}\n` +
                `${tTijd}\n` +
                `${tKm}\n\n` +
                `Klopt dit? Klik OK om de mail te openen.`
            );

            if (bevestiging) {
                const d1 = document.getElementById('rit-datum').value;
                const bus = document.getElementById('bus-nummer').value || "---";
                const klant = document.getElementById('klant-naam').value || "---";
                const van = document.getElementById('van-plaats').value || "---";
                const naar = document.getElementById('naar-plaats').value || "---";
                const stremming = document.getElementById('stremming').checked ? "JA" : "Nee";

                let body = `RITREGISTRATIE BERKHOUT\n----------------------\n`;
                body += `Chauffeur: ${chauffeur}\nStremming: ${stremming}\nBus: ${bus}\nDatum: ${d1}\nKlant: ${klant}\nTraject: ${van} - ${naar}\n\n`;
                
                locaties.forEach((loc, i) => {
                    body += `${loc}: ${document.getElementById('tijd-'+i).innerText} | KM: ${document.getElementById('km-'+i).value || '0'}\n`;
                });

                body += `\n${tTijd}\n${tKm}`;
                window.location.href = `mailto:info@taxiberkhout.nl?subject=Ritregistratie ${chauffeur}&body=${encodeURIComponent(body)}`;
            }
        }

        function wisAlles() { if(confirm("Alle velden leegmaken voor een nieuwe rit?")) location.reload(); }
        initApp();
    </script>
</body>
</html>
