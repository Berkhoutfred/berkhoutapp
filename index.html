<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Berkhout Ritregistratie</title>
    <style>
        body { font-family: sans-serif; background: #f0f0f5; margin: 0; padding: 15px; color: #333; }
        .card { background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h2 { font-size: 18px; margin: 0 0 15px 0; color: #0056b3; border-bottom: 2px solid #f0f0f5; padding-bottom: 5px; }
        
        label { display: block; font-size: 12px; font-weight: bold; color: #666; text-transform: uppercase; margin-bottom: 4px; }
        input[type="text"], input[type="date"], input[type="number"], select {
            width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; background: #fff; margin-bottom: 12px;
        }

        /* Treinstremming Switch */
        .stremming-box {
            display: flex; align-items: center; justify-content: space-between;
            background: #fff3cd; padding: 12px; border-radius: 8px; border: 1px solid #ffeeba; margin-bottom: 15px;
        }
        .stremming-box label { margin: 0; color: #856404; font-size: 15px; }
        input[type="checkbox"] { width: 24px; height: 24px; cursor: pointer; }

        .rit-rij { padding: 10px 0; border-bottom: 1px solid #eee; }
        .locatie-naam { font-weight: bold; margin-bottom: 6px; }
        
        .input-groep { display: flex; gap: 8px; align-items: center; }
        .tijd-selector { display: flex; align-items: center; background: #eee; border-radius: 6px; flex: 1; overflow: hidden; }
        .t-btn { background: #0056b3; color: white; border: none; width: 45px; height: 45px; font-size: 20px; font-weight: bold; cursor: pointer; }
        .tijd-val { flex: 1; text-align: center; font-weight: bold; font-size: 16px; }
        
        .km-input { width: 110px !important; margin-bottom: 0 !important; }

        .totaal-sectie { background: #e7f3ff; padding: 15px; border-radius: 8px; border: 1px solid #b3d7ff; margin-top: 5px; }
        .totaal-regel { display: flex; justify-content: space-between; margin-bottom: 5px; font-weight: bold; }
        .totaal-waarde { color: #0056b3; font-size: 18px; }

        .btn-verzend { background: #28a745; color: white; width: 100%; padding: 16px; font-size: 18px; font-weight: bold; border: none; border-radius: 8px; margin-top: 15px; cursor: pointer; }
        .btn-wis { background: #dc3545; color: white; width: 100%; padding: 10px; font-size: 14px; border: none; border-radius: 8px; margin-top: 10px; cursor: pointer; opacity: 0.8; }
    </style>
</head>
<body>

    <div class="card">
        <h2>Ritgegevens</h2>
        
        <div class="stremming-box">
            <label for="stremming">⚠️ Treinstremming (NS)</label>
            <input type="checkbox" id="stremming">
        </div>

        <div style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>Begindatum</label>
                <input type="date" id="rit-datum">
            </div>
            <div style="flex: 1;">
                <label>Einddatum</label>
                <input type="date" id="rit-einddatum">
            </div>
        </div>

        <label>Bus nummer</label>
        <select id="bus-nummer">
            <option value="">Kies bus...</option>
            <option value="19">19</option>
            <option value="23">23</option>
            <option value="50">50</option>
            <option value="53">53</option>
            <option value="60">60</option>
            <option value="62">62</option>
        </select>

        <label>Klant / Opdrachtgever</label>
        <input type="text" id="klant-naam" placeholder="Bijv. NS of CV de Gorsselnarren">

        <div style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>Van</label>
                <input type="text" id="van-plaats" placeholder="Vertrek">
            </div>
            <div style="flex: 1;">
                <label>Naar</label>
                <input type="text" id="naar-plaats" placeholder="Bestemming">
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Tijden & KM-standen</h2>
        <div id="ritLijst"></div>
        
        <div class="totaal-sectie">
            <div class="totaal-regel">
                <span>Diensttijd:</span>
                <span class="totaal-waarde" id="totaalTijd">0u 0m</span>
            </div>
            <div class="totaal-regel">
                <span>Totaal KM:</span>
                <span class="totaal-waarde" id="totaalKm">0 km</span>
            </div>
        </div>
    </div>

    <button class="btn-verzend" onclick="verstuurMail()">VERSTUUR RITDATA</button>
    <button class="btn-wis" onclick="wisAlles()">WIS VELDEN</button>

    <script>
        const locaties = ["Vertrek garage", "Vertrek klant", "Aankomst bestemming", "Vertrek bestemming", "Retour klant", "Retour garage"];
        const standaardTijden = ["08:00", "08:30", "10:00", "16:00", "17:30", "18:00"];

        function initApp() {
            const vandaag = new Date();
            document.getElementById('rit-datum').valueAsDate = vandaag;
            document.getElementById('rit-einddatum').valueAsDate = vandaag;
            
            let html = "";
            locaties.forEach((loc, index) => {
                html += `
                <div class="rit-rij">
                    <div class="locatie-naam">${loc}</div>
                    <div class="input-groep">
                        <div class="tijd-selector">
                            <button class="t-btn" onclick="pasTijdAan(${index}, -15)">-</button>
                            <div class="tijd-val" id="tijd-${index}">${standaardTijden[index]}</div>
                            <button class="t-btn" onclick="pasTijdAan(${index}, 15)">+</button>
                        </div>
                        <input type="number" id="km-${index}" class="km-input" placeholder="KM" oninput="berekenAlles()">
                    </div>
                </div>`;
            });
            document.getElementById('ritLijst').innerHTML = html;
            berekenAlles();
        }

        function pasTijdAan(id, min) {
            let display = document.getElementById(`tijd-${id}`);
            let t = display.innerText.split(":");
            let d = new Date();
            d.setHours(parseInt(t[0]), parseInt(t[1]) + min);
            display.innerText = ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2);
            berekenAlles();
        }

        function berekenAlles() {
            let standen = [];
            for(let i=0; i<6; i++) {
                let v = document.getElementById(`km-${i}`).value;
                if(v) standen.push(parseInt(v));
            }
            if(standen.length >= 2) {
                document.getElementById('totaalKm').innerText = (Math.max(...standen) - Math.min(...standen)) + " km";
            } else {
                document.getElementById('totaalKm').innerText = "0 km";
            }

            let tStart = document.getElementById('tijd-0').innerText.split(":");
            let tEind = document.getElementById('tijd-5').innerText.split(":");
            let diff = ((parseInt(tEind[0])*60)+parseInt(tEind[1])) - ((parseInt(tStart[0])*60)+parseInt(tStart[1]));
            
            // Check of einddatum later is dan begindatum voor nachtritten
            const d1 = new Date(document.getElementById('rit-datum').value);
            const d2 = new Date(document.getElementById('rit-einddatum').value);
            if (d2 > d1) diff += 1440; 
            else if(diff < 0) diff += 1440; // Veiligheidshalve als ze datum vergeten

            document.getElementById('totaalTijd').innerText = Math.floor(diff/60) + "u " + (diff%60) + "m";
        }

        function wisAlles() {
            if(confirm("Alle velden leegmaken?")) {
                document.getElementById('bus-nummer').value = "";
                document.getElementById('klant-naam').value = "";
                document.getElementById('van-plaats').value = "";
                document.getElementById('naar-plaats').value = "";
                document.getElementById('stremming').checked = false;
                for(let i=0; i<6; i++) { document.getElementById(`km-${i}`).value = ""; }
                berekenAlles();
            }
        }

        function verstuurMail() {
            const d1 = document.getElementById('rit-datum').value;
            const d2 = document.getElementById('rit-einddatum').value;
            const bus = document.getElementById('bus-nummer').value || "Onbekend";
            const stremming = document.getElementById('stremming').checked ? "JA (Treinstremming)" : "Nee";
            const klant = document.getElementById('klant-naam').value || "Geen opgave";

            let body = `RITREGISTRATIE%0A----------------------%0A`;
            body += `Treinstremming: ${stremming}%0A`;
            body += `Datum: ${d1} t/m ${d2}%0A`;
            body += `Bus: ${bus}%0AKlant: ${klant}%0A%0A`;
            
            locaties.forEach((loc, i) => {
                body += `${loc}: ${document.getElementById('tijd-'+i).innerText} | KM: ${document.getElementById('km-'+i).value || '---'}%0A`;
            });

            body += `%0ATotaal tijd: ${document.getElementById('totaalTijd').innerText}`;
            body += `%0ATotaal KM: ${document.getElementById('totaalKm').innerText}%0A`;
            
            if(document.getElementById('stremming').checked) {
                body += `%0AALERTE: Afwijkende verloning toepassen voor stremming!`;
            }

            window.location.href = `mailto:info@taxiberkhout.nl?subject=Ritregistratie Bus ${bus} (${d1})&body=${body}`;
        }

        initApp();
    </script>
</body>
</html>
